/*! grafana - v3.0.0-pre1 - 2016-02-22
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["./bucket_agg","./metric_agg","angular","app/plugins/sdk"],function(a){var b,c,d,e=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};return{setters:[function(a){},function(a){},function(a){b=a},function(a){c=a}],execute:function(){d=function(a){function c(b,c,d,e,f){a.call(this,b,c),this.$rootScope=d,this.$timeout=e,this.uiSegmentSrv=f,this.esVersion=this.datasource.esVersion,this.queryUpdated()}return e(c,a),c.$inject=["$scope","$injector","$rootScope","$timeout","uiSegmentSrv"],c.prototype.getFields=function(a){var c=b["default"].toJson({find:"fields",type:a});return this.datasource.metricFindQuery(c).then(this.uiSegmentSrv.transformToSegments(!1))["catch"](this.handleQueryError.bind(this))},c.prototype.queryUpdated=function(){var a=b["default"].toJson(this.datasource.queryBuilder.build(this.target),!0);a!==this.rawQueryOld&&(this.rawQueryOld=a,this.refresh()),this.$rootScope.appEvent("elastic-query-updated")},c.prototype.handleQueryError=function(a){return this.error=a.message||"Failed to issue metric query",[]},c.templateUrl="partials/query.editor.html",c}(c.QueryCtrl),a("ElasticQueryCtrl",d)}}});