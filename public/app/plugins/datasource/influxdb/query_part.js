/*! grafana - v3.0.0-pre1 - 2016-02-22
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["lodash"],function(a){function b(a,b){var c=a.def.type+"(",d=k["default"].map(a.params,function(b,c){var d=a.def.params[c];return"time"===d.type&&"auto"===b&&(b="$interval"),"single"===d.quote?"'"+b+"'":"double"===d.quote?'"'+b+'"':b});return b&&d.unshift(b),c+d.join(", ")+")"}function c(a,b){return b+' AS "'+a.params[0]+'"'}function d(a,b){return b+" "+a.params[0]}function e(a,b){return"*"===a.params[0]?"*":'"'+a.params[0]+'"'}function f(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.def.category===m.Aggregations)return void(a[c]=b);if(d.def.category===m.Selectors)return void(a[c]=b)}a.splice(1,0,b)}function g(a,b){var c;for(c=0;c<a.length;c++){var d=a[c];if(d.def.category===m.Math||d.def.category===m.Aliasing)break}a.splice(c,0,b)}function h(a,b){var c=a.length;if(c>0){if("math"===a[c-1].def.type)return void(a[c-1]=b);if("math"===a[c-2].def.type)return void(a[c-2]=b);if("alias"===a[c-1].def.type)return void a.splice(c-1,0,b)}a.push(b)}function i(a,b){var c=a.length;return c>0&&"alias"===a[c-1].def.type?void(a[c-1]=b):void a.push(b)}function j(a,b,c){var d=k["default"].map(a,function(a){return new p({type:a.def.type,params:k["default"].clone(a.params)})});c.selectModels.push(d)}var k,l,m,n,o,p;return{setters:[function(a){k=a}],execute:function(){l=[],m={Aggregations:[],Selectors:[],Transformations:[],Math:[],Aliasing:[],Fields:[]},n=[],o=function(){function a(a){this.type=a.type,this.params=a.params,this.defaultParams=a.defaultParams,this.renderer=a.renderer,this.category=a.category,this.addStrategy=a.addStrategy}return a.register=function(b){l[b.type]=new a(b),b.category.push(l[b.type])},a}(),o.register({type:"field",addStrategy:j,category:m.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:e}),o.register({type:"count",addStrategy:f,category:m.Aggregations,params:[],defaultParams:[],renderer:b}),o.register({type:"distinct",addStrategy:f,category:m.Aggregations,params:[],defaultParams:[],renderer:b}),o.register({type:"integral",addStrategy:f,category:m.Aggregations,params:[],defaultParams:[],renderer:b}),o.register({type:"mean",addStrategy:f,category:m.Aggregations,params:[],defaultParams:[],renderer:b}),o.register({type:"median",addStrategy:f,category:m.Aggregations,params:[],defaultParams:[],renderer:b}),o.register({type:"sum",addStrategy:f,category:m.Aggregations,params:[],defaultParams:[],renderer:b}),o.register({type:"derivative",addStrategy:g,category:m.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:b}),o.register({type:"non_negative_derivative",addStrategy:g,category:m.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:b}),o.register({type:"stddev",addStrategy:g,category:m.Transformations,params:[],defaultParams:[],renderer:b}),o.register({type:"time",category:n,params:[{name:"interval",type:"time",options:["auto","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["auto"],renderer:b}),o.register({type:"fill",category:n,params:[{name:"fill",type:"string",options:["none","null","0","previous"]}],defaultParams:["null"],renderer:b}),o.register({type:"bottom",addStrategy:f,category:m.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:b}),o.register({type:"first",addStrategy:f,category:m.Selectors,params:[],defaultParams:[],renderer:b}),o.register({type:"last",addStrategy:f,category:m.Selectors,params:[],defaultParams:[],renderer:b}),o.register({type:"max",addStrategy:f,category:m.Selectors,params:[],defaultParams:[],renderer:b}),o.register({type:"min",addStrategy:f,category:m.Selectors,params:[],defaultParams:[],renderer:b}),o.register({type:"percentile",addStrategy:f,category:m.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:b}),o.register({type:"top",addStrategy:f,category:m.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:b}),o.register({type:"tag",category:n,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:e}),o.register({type:"math",addStrategy:h,category:m.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:d}),o.register({type:"alias",addStrategy:i,category:m.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:c}),p=function(){function a(a){if(this.part=a,this.def=l[a.type],!this.def)throw{message:"Could not find query part "+a.type};a.params=a.params||k["default"].clone(this.def.defaultParams),this.params=a.params,this.updateText()}return a.prototype.render=function(a){return this.def.renderer(this,a)},a.prototype.hasMultipleParamsInString=function(a,b){return-1===a.indexOf(",")?!1:this.def.params[b+1]&&this.def.params[b+1].optional},a.prototype.updateParam=function(a,b){return this.hasMultipleParamsInString(a,b)?void k["default"].each(a.split(","),function(a,b){this.updateParam(a.trim(),b)},this):(""===a&&this.def.params[b].optional?this.params.splice(b,1):this.params[b]=a,this.part.params=this.params,void this.updateText())},a.prototype.updateText=function(){if(0===this.params.length)return void(this.text=this.def.type+"()");var a=this.def.type+"(";a+=this.params.join(", "),a+=")",this.text=a},a}(),a("default",{create:function(a){return new p(a)},getCategories:function(){return m}})}}});