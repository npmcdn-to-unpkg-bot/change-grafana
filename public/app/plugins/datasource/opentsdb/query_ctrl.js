/*! grafana - v3.0.0-pre1 - 2016-02-22
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["lodash","app/core/utils/kbn","app/plugins/sdk"],function(a){var b,c,d,e,f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};return{setters:[function(a){b=a},function(a){c=a},function(a){d=a}],execute:function(){e=function(a){function d(b,c){var d=this;a.call(this,b,c),this.errors=this.validateTarget(),this.aggregators=["avg","sum","min","max","dev","zimsum","mimmin","mimmax"],this.fillPolicies=["none","nan","null","zero"],this.target.aggregator||(this.target.aggregator="sum"),this.target.downsampleAggregator||(this.target.downsampleAggregator="avg"),this.target.downsampleFillPolicy||(this.target.downsampleFillPolicy="none"),this.datasource.getAggregators().then(function(a){this.aggregators=a}),this.suggestMetrics=function(a,b){d.datasource.metricFindQuery("metrics("+a+")").then(d.getTextValues).then(b)},this.suggestTagKeys=function(a,b){d.datasource.suggestTagKeys(d.target.metric).then(b)},this.suggestTagValues=function(a,b){d.datasource.metricFindQuery("suggest_tagv("+a+")").then(d.getTextValues).then(b)}}return f(d,a),d.$inject=["$scope","$injector"],d.prototype.targetBlur=function(){this.errors=this.validateTarget(),this.refresh()},d.prototype.getTextValues=function(a){return b["default"].map(a,function(a){return a.text})},d.prototype.addTag=function(){return this.addTagMode?(this.target.tags||(this.target.tags={}),this.errors=this.validateTarget(),this.errors.tags||(this.target.tags[this.target.currentTagKey]=this.target.currentTagValue,this.target.currentTagKey="",this.target.currentTagValue="",this.targetBlur()),void(this.addTagMode=!1)):void(this.addTagMode=!0)},d.prototype.removeTag=function(a){delete this.target.tags[a],this.targetBlur()},d.prototype.editTag=function(a,b){this.removeTag(a),this.target.currentTagKey=a,this.target.currentTagValue=b,this.addTag()},d.prototype.validateTarget=function(){var a={};if(this.target.shouldDownsample)try{this.target.downsampleInterval?c["default"].describe_interval(this.target.downsampleInterval):a.downsampleInterval="You must supply a downsample interval (e.g. '1m' or '1h')."}catch(d){a.downsampleInterval=d.message}return this.target.tags&&b["default"].has(this.target.tags,this.target.currentTagKey)&&(a.tags="Duplicate tag key '"+this.target.currentTagKey+"'."),a},d.templateUrl="partials/query.editor.html",d}(d.QueryCtrl),a("OpenTsQueryCtrl",e)}}});