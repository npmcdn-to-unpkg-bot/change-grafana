/*! grafana - v3.0.0-pre1 - 2016-02-22
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["lodash","app/plugins/sdk"],function(a){var b,c,d,e,f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};return{setters:[function(a){b=a},function(a){c=a}],execute:function(){d={mode:"markdown",content:"# title"},e=function(a){function c(c,e,f,g){a.call(this,c,e),this.templateSrv=f,this.$sce=g,b["default"].defaults(this.panel,d)}return f(c,a),c.$inject=["$scope","$injector","templateSrv","$sce"],c.prototype.initEditMode=function(){a.prototype.initEditMode.call(this),this.icon="fa fa-text-width",this.addEditorTab("Options","public/app/plugins/panel/text/editor.html"),this.editorTabIndex=1},c.prototype.refresh=function(){this.render()},c.prototype.render=function(){"markdown"===this.panel.mode?this.renderMarkdown(this.panel.content):"html"===this.panel.mode?this.updateContent(this.panel.content):"text"===this.panel.mode&&this.renderText(this.panel.content),this.renderingCompleted()},c.prototype.renderText=function(a){a=a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\n/g,"<br/>"),this.updateContent(a)},c.prototype.renderMarkdown=function(a){var b=this,c=a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;");this.converter?this.updateContent(this.converter.makeHtml(c)):System["import"]("vendor/showdown").then(function(a){b.converter=new a.converter,b.$scope.$apply(function(){b.updateContent(b.converter.makeHtml(c))})})},c.prototype.updateContent=function(a){try{this.content=this.$sce.trustAsHtml(this.templateSrv.replace(a,this.panel.scopedVars))}catch(b){console.log("Text panel error: ",b),this.content=this.$sce.trustAsHtml(a)}},c.templateUrl="public/app/plugins/panel/text/module.html",c}(c.PanelCtrl),a("TextPanelCtrl",e),a("PanelCtrl",e)}}});