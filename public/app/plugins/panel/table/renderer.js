/*! grafana - v3.0.0-pre1 - 2016-02-22
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["lodash","moment","app/core/utils/kbn"],function(a){var b,c,d,e;return{setters:[function(a){b=a},function(a){c=a},function(a){d=a}],execute:function(){e=function(){function a(a,b,c){this.panel=a,this.table=b,this.timezone=c,this.formaters=[],this.colorState={}}return a.prototype.getColorForValue=function(a,c){if(!c.thresholds)return null;for(var d=c.thresholds.length;d>0;d--)if(a>=c.thresholds[d-1])return c.colors[d];return b["default"].first(c.colors)},a.prototype.defaultCellFormater=function(a){return null===a||void 0===a||void 0===a?"":(b["default"].isArray(a)&&(a=a.join(",&nbsp;")),a)},a.prototype.createColumnFormater=function(a){var e=this;if(!a)return this.defaultCellFormater;if("date"===a.type)return function(d){b["default"].isArray(d)&&(d=d[0]);var f=c["default"](d);return"utc"===e.timezone&&(f=f.utc()),f.format(a.dateFormat)};if("number"===a.type){var f=d["default"].valueFormats[a.unit];return function(c){return null===c||void 0===c?"-":b["default"].isString(c)?c:(a.colorMode&&(e.colorState[a.colorMode]=e.getColorForValue(c,a)),f(c,a.decimals,null))}}return this.defaultCellFormater},a.prototype.formatColumnValue=function(a,b){if(this.formaters[a])return this.formaters[a](b);for(var c=0;c<this.panel.styles.length;c++){var e=this.panel.styles[c],f=this.table.columns[a],g=d["default"].stringToJsRegex(e.pattern);if(f.text.match(g))return this.formaters[a]=this.createColumnFormater(e),this.formaters[a](b)}return this.formaters[a]=this.defaultCellFormater,this.formaters[a](b)},a.prototype.renderCell=function(a,c,d){void 0===d&&(d=!1),c=this.formatColumnValue(a,c),c=b["default"].escape(c);var e="";this.colorState.cell?(e=' style="background-color:'+this.colorState.cell+';color: white"',this.colorState.cell=null):this.colorState.value&&(e=' style="color:'+this.colorState.value+'"',this.colorState.value=null);var f="";return d&&(f='<div class="table-panel-width-hack">'+this.table.columns[a].text+"</div>"),"<td"+e+">"+c+f+"</td>"},a.prototype.render=function(a){for(var b=this.panel.pageSize||100,c=a*b,d=Math.min(c+b,this.table.rows.length),e="",f=c;d>f;f++){for(var g=this.table.rows[f],h="",i="",j=0;j<this.table.columns.length;j++)h+=this.renderCell(j,g[j],f===c);this.colorState.row&&(i=' style="background-color:'+this.colorState.row+';color: white"',this.colorState.row=null),e+="<tr "+i+">"+h+"</tr>"}return e},a}(),a("TableRenderer",e)}}});