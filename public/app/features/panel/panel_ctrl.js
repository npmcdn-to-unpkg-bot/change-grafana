/*! grafana - v3.0.0-pre1 - 2016-02-22
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["app/core/config","lodash","angular"],function(a){var b,c,d,e;return{setters:[function(a){b=a},function(a){c=a},function(a){d=a}],execute:function(){e=function(){function a(a,c){var d=this;this.$injector=c,this.$scope=a,this.$timeout=c.get("$timeout"),this.editorTabIndex=0;var e=b["default"].panels[this.panel.type];e&&(this.pluginId=e.id,this.pluginName=e.name),a.$on("refresh",function(){return d.refresh()})}return a.prototype.init=function(){this.publishAppEvent("panel-instantiated",{scope:this.$scope}),this.refresh()},a.prototype.renderingCompleted=function(){this.$scope.$root.performance.panelsRendered++},a.prototype.refresh=function(){},a.prototype.publishAppEvent=function(a,b){this.$scope.$root.appEvent(a,b)},a.prototype.changeView=function(a,b){this.publishAppEvent("panel-change-view",{fullscreen:a,edit:b,panelId:this.panel.id})},a.prototype.viewPanel=function(){this.changeView(!0,!1)},a.prototype.editPanel=function(){this.changeView(!0,!0)},a.prototype.exitFullscreen=function(){this.changeView(!1,!1)},a.prototype.initEditMode=function(){this.editorTabs=[],this.addEditorTab("General","public/app/partials/panelgeneral.html"),this.editModeInitiated=!0},a.prototype.addEditorTab=function(a,b,d){var e={title:a,directiveFn:b};c["default"].isString(b)&&(e.directiveFn=function(){return{templateUrl:b}}),d?this.editorTabs.splice(d,0,e):this.editorTabs.push(e)},a.prototype.getMenu=function(){var a=[];return a.push({text:"View",click:"ctrl.viewPanel(); dismiss();"}),a.push({text:"Edit",click:"ctrl.editPanel(); dismiss();",role:"Editor"}),this.fullscreen||a.push({text:"Duplicate",click:"ctrl.duplicate()",role:"Editor"}),a.push({text:"Share",click:"ctrl.sharePanel(); dismiss();"}),a},a.prototype.getExtendedMenu=function(){return[{text:"Panel JSON",click:"ctrl.editPanelJson(); dismiss();"}]},a.prototype.otherPanelInFullscreenMode=function(){return this.dashboard.meta.fullscreen&&!this.fullscreen},a.prototype.broadcastRender=function(a,b){this.$scope.$broadcast("render",a,b)},a.prototype.toggleEditorHelp=function(a){return this.editorHelpIndex===a?void(this.editorHelpIndex=null):void(this.editorHelpIndex=a)},a.prototype.duplicate=function(){this.dashboard.duplicatePanel(this.panel,this.row)},a.prototype.updateColumnSpan=function(a){var b=this;this.panel.span=Math.min(Math.max(Math.floor(this.panel.span+a),1),12),this.$timeout(function(){b.broadcastRender()})},a.prototype.removePanel=function(){var a=this;this.publishAppEvent("confirm-modal",{title:"Are you sure you want to remove this panel?",icon:"fa-trash",yesText:"Delete",onConfirm:function(){a.row.panels=c["default"].without(a.row.panels,a.panel)}})},a.prototype.editPanelJson=function(){this.publishAppEvent("show-json-editor",{object:this.panel,updateHandler:this.replacePanel.bind(this)})},a.prototype.replacePanel=function(a,b){var d=this,e=(this.row,c["default"].indexOf(this.row.panels,b));this.row.panels.splice(e,1),this.$timeout(function(){a.id=b.id,a.span=b.span,d.row.panels.splice(e,0,a)})},a.prototype.sharePanel=function(){var a=this.$scope.$new();a.panel=this.panel,a.dashboard=this.dashboard,this.publishAppEvent("show-modal",{src:"public/app/features/dashboard/partials/shareModal.html",scope:a})},a.prototype.openInspector=function(){var a=this.$scope.$new();a.panel=this.panel,a.dashboard=this.dashboard,a.inspector=d["default"].copy(this.inspector),this.publishAppEvent("show-modal",{src:"public/app/partials/inspector.html",scope:a})},a}(),a("PanelCtrl",e)}}});